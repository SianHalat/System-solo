<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM V50 - Boss Encounter</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&family=Noto+Sans+SC&family=Noto+Sans+JP&display=swap" rel="stylesheet">
    <style>
        :root { 
            --blue: #00eaff; 
            --purple: #bf00ff; 
            --gold: #ffd700;
            --red: #ff3333; 
            --green: #33ff33;
            --orange: #ffa500;
            --white: #ffffff;
            --gray: #444;
            --bg: #02050a;
            --sys-text-glow: 0 0 8px var(--blue);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; outline: none;}
        
        body { 
            background-color: var(--bg);
            background-image: 
                radial-gradient(circle at 50% 50%, transparent 20%, #02050a 120%),
                linear-gradient(rgba(0, 234, 255, 0.08) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 234, 255, 0.08) 1px, transparent 1px);
            background-size: 100% 100%, 30px 30px, 30px 30px;
            background-attachment: fixed;
            color: #fff; 
            font-family: 'Chakra Petch', sans-serif; 
            min-height: 100vh; 
            padding: 15px; 
            padding-bottom: 90px; 
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
        }

        /* OVERLAYS */
        #toxic-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9000; opacity: 0; transition: opacity 0.5s; mix-blend-mode: overlay; }
        .toxic-red { background: radial-gradient(circle, transparent 50%, var(--red) 100%); animation: pulse-red 1s infinite; }
        .detox-green { background: radial-gradient(circle, transparent 50%, var(--green) 100%); animation: pulse-green 1s ease-out; }
        @keyframes pulse-red { 0% { opacity: 0.6; } 50% { opacity: 0.9; } 100% { opacity: 0.6; } }
        @keyframes pulse-green { 0% { opacity: 0; } 50% { opacity: 0.8; } 100% { opacity: 0; } }

        .layout-wrapper { width: 100%; max-width: 500px; position: relative; }

        .main-frame { 
            width: 100%; border: 2px solid #fff; padding: 25px; 
            background: rgba(2, 8, 20, 0.95); position: relative; box-shadow: var(--glow); 
            padding-top: 20px; backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); z-index: 10;
            min-height: 650px; display: flex; flex-direction: column; 
        }
        .main-frame::before { content: ''; position: absolute; top: -2px; left: -2px; width: 15px; height: 15px; border-top: 4px solid #fff; border-left: 4px solid #fff; }
        .main-frame::after { content: ''; position: absolute; bottom: -2px; right: -2px; width: 15px; height: 15px; border-bottom: 4px solid #fff; border-right: 4px solid #fff; }

        /* UI ELEMENTS */
        .top-right-stack { position: absolute; top: 30px; right: 25px; display: flex; flex-direction: column; align-items: flex-end; gap: 10px; z-index: 50; }
        .kebab-btn { width: 20px; height: 20px; position: relative; background: none; border: none; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .kebab-btn::before { content: ''; width: 4px; height: 4px; border-radius: 50%; background: #fff; box-shadow: 0 -7px 0 #fff, 0 7px 0 #fff; filter: drop-shadow(0 0 3px var(--blue)); }
        
        .res-row { font-size: 0.8rem; color: #8899aa; display: flex; gap: 10px; align-items: center; justify-content: flex-end; height: 24px; }
        .sys-num-unified { color: #fff; font-family: 'Chakra Petch', sans-serif; font-weight: 700; font-size: 1.2rem; text-shadow: var(--sys-text-glow); letter-spacing: 1px; }

        #gold-container-wrapper { width: 100%; display: none; justify-content: flex-end; margin-top: 8px; }
        .gold-box-frame { border: 2px solid #fff; background: rgba(2, 8, 20, 0.9); backdrop-filter: blur(4px); box-shadow: var(--glow); padding: 5px 20px; display: flex; align-items: center; gap: 15px; position: relative; }
        .gold-wrapper { display: inline-flex; align-items: center; }
        .gold-icon { display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; border: 1.5px solid #fff; border-radius: 50%; box-shadow: 0 0 8px var(--blue), inset 0 0 2px var(--blue); color: #fff; font-size: 0.7rem; font-weight: 800; text-shadow: 0 0 5px var(--blue); margin-left: 5px; position: relative; top: -1px; }

        .content { display: none; width: 100%; }
        .content.active { display: block; animation: system-fade 0.4s ease; }
        @keyframes system-fade { 0% { opacity: 0; transform: translateY(10px); } 100% { opacity: 1; transform: translateY(0); } }

        h2.tab-title { text-align: center; letter-spacing: 5px; text-shadow: 0 0 10px var(--blue); margin-bottom: 20px; font-size: 1.8rem; margin-top: 10px; }
        
        .header-grid { display: grid; grid-template-columns: auto 1fr; gap: 25px; align-items: end; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 20px; margin-bottom: 20px; }
        .lvl-num { font-size: 4.5rem; font-weight: 700; text-shadow: 0 0 15px #fff; line-height: 0.8; }
        .info-box { display: flex; flex-direction: column; gap: 6px; }
        .info-row { font-size: 0.85rem; color: #888; display: flex; align-items: center; margin-bottom: 4px; }
        .info-val { color: #fff; font-weight: bold; text-transform: uppercase; text-shadow: var(--sys-text-glow); }
        .rank-box { color: #fff; border: 1px solid var(--blue); padding: 0 5px; margin-left: 5px; font-weight: bold; text-shadow: var(--sys-text-glow); box-shadow: 0 0 5px rgba(0, 234, 255, 0.3); }

        .xp-text-display { font-size: 0.8rem; color: #fff; text-shadow: var(--sys-text-glow); font-weight: 700; margin-bottom: 4px; display: flex; justify-content: space-between; }
        .bar-container { width: 100%; height: 4px; background: rgba(255,255,255,0.1); margin-top: 5px; }
        .bar-fill { height: 100%; width: 0%; transition: width 0.5s ease; }
        .xp-fill { background: #fff; box-shadow: 0 0 10px #fff; }
        .fatigue-fill { background: var(--red); box-shadow: 0 0 10px var(--red); }
        
        .stat-row { display: flex; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px; margin-bottom: 8px; }
        .stat-label { font-size: 1.2rem; font-weight: 600; color: #ccc; width: 50px; }
        .stat-val { font-size: 1.6rem; font-weight: 700; margin-left: 10px; color: #fff; text-shadow: var(--sys-text-glow); }
        .stat-bonus { font-size: 0.9rem; color: var(--blue); margin-left: 5px; font-weight: normal; } 
        .plus-btn { width: 24px; height: 24px; border: 1px solid var(--blue); margin-left: auto; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--blue); }

        .skills-container { margin-top: 20px; border-top: 1px solid #333; padding-top: 10px; }
        .skill-header { font-size: 1rem; color: var(--blue); margin-bottom: 10px; font-weight: bold; }
        .skill-card { border: 1px solid #444; background: rgba(0,0,0,0.3); padding: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .skill-name { font-weight: bold; color: #fff; }
        .skill-desc { font-size: 0.7rem; color: #888; }
        .skill-btn { border: 1px solid #555; color: #555; background: none; font-size: 0.7rem; padding: 4px 10px; cursor: pointer; text-transform: uppercase; }
        .skill-btn.active { background: var(--blue); color: #000; border-color: var(--blue); box-shadow: 0 0 8px var(--blue); font-weight: bold;}
        .skill-btn.passive { border: 1px solid #333; color: #888; cursor: default; }

        .quest-item { display: flex; flex-direction: column; padding: 15px 0; border-bottom: 1px solid #333; }
        .q-top { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .q-controls { display: flex; align-items: center; gap: 10px; margin-top: 5px;}
        .q-btn { background: #333; border: 1px solid #555; color: #fff; width: 30px; height: 30px; cursor: pointer; font-weight: bold; }
        .q-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .q-val { font-family: monospace; font-size: 1rem; color: var(--blue); width: 100px; text-align: center;}
        .q-complete { color: var(--blue); text-shadow: 0 0 5px var(--blue); } 
        .q-over { color: var(--blue); font-weight: bold; text-shadow: 0 0 8px var(--blue); }

        .zone-selector {
            width: 100%; padding: 10px; margin-bottom: 20px;
            background: rgba(0,0,0,0.8); color: var(--blue);
            border: 1px solid var(--blue); font-family: 'Chakra Petch', sans-serif;
            font-weight: bold; text-transform: uppercase; outline: none;
        }

        .dungeon-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #333; align-items: center; }
        .mon-white { color: var(--white); }
        .mon-orange { color: var(--orange); } 
        .mon-red { color: var(--red); }
        .mon-purple { color: var(--purple); font-weight:bold;}

        .enter-btn { border: 1px solid var(--red); color: var(--red); background: rgba(255, 50, 50, 0.1); padding: 5px 15px; font-weight: bold; cursor: pointer; min-width: 80px; }
        .enter-btn.cooldown { border: 1px solid var(--gray); color: var(--gray); background: rgba(0,0,0,0.5); cursor: not-allowed; font-size: 0.7rem; }
        .enter-btn.instance { border: 1px solid var(--purple); color: var(--purple); background: rgba(191, 0, 255, 0.1); }
        
        .claim-btn { width:100%; padding:15px; margin-top:20px; border:1px solid var(--blue); color:var(--blue); background:rgba(0,234,255,0.1); font-weight:bold; cursor:pointer; }
        .claim-btn.disabled { border:1px solid var(--gray); color:var(--gray); background:transparent; cursor:not-allowed; }

        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .shop-item { border: 1px solid var(--blue); padding: 12px; background: rgba(0,0,0,0.6); cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; height: 110px; gap: 5px; }
        .item-card { border: 1px solid var(--blue); background: rgba(0,234,255,0.05); padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;}
        .btn-small { border: 1px solid var(--blue); color: var(--blue); background:none; padding: 2px 8px; font-size: 0.7rem; cursor: pointer; margin-left: 5px;}
        .btn-small.equip { border-color: var(--purple); color: var(--purple); text-shadow: 0 0 5px var(--purple); }

        #sys-modal, #reward-modal, #penalty-modal, #dungeon-confirm-modal { position: absolute; top: 100px; left: 5%; width: 90%; background: rgba(2, 8, 20, 0.98); border: 2px solid var(--blue); box-shadow: 0 0 30px var(--blue); z-index: 2000; display: none; flex-direction: column; padding: 20px; text-align: center; animation: sys-open 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #penalty-modal { border-color: var(--red); box-shadow: 0 0 30px var(--red); top: 50px; }
        #reward-modal { border-color: var(--blue); box-shadow: 0 0 30px var(--blue); } 
        
        .reward-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .reward-box-item { border: 1px solid #fff; padding: 10px; color: #fff; font-size: 0.8rem; font-weight: bold; } 
        
        .timer-digits { font-size: 2.5rem; font-weight: 700; color: #fff; text-shadow: 0 0 15px var(--blue); font-family: 'Chakra Petch', sans-serif; letter-spacing: 3px; }
        .active-mission-box { margin-top: 30px; margin-bottom: 10px; padding: 15px; border: 2px solid var(--blue); background: rgba(0, 234, 255, 0.05); text-align: center; display: none; }
        .active-mission-box.visible { display: block; }

        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #02050a; border-top: 2px solid #fff; display: flex; justify-content: space-around; padding: 15px 0; z-index: 100; }
        .nav-btn { background: none; border: none; color: #444; font-family: inherit; font-size: 0.8rem; font-weight: bold; letter-spacing: 1px; }
        .nav-btn.active { color: #fff; text-shadow: var(--glow); transform: scale(1.1); }
        
        #notification { position: fixed; top: 20px; width: 80%; left: 10%; background: var(--blue); color: #000; padding: 10px; text-align: center; font-weight: bold; z-index: 3000; display: none; box-shadow: 0 0 20px var(--blue); animation: system-fade 0.2s; }
        #notification.positive { background: var(--green); color: #000; box-shadow: 0 0 20px var(--green); }
        #notification.negative { background: var(--red); color: #fff; box-shadow: 0 0 20px var(--red); }

        /* DUNGEON CONFIRMATION STYLES */
        .boss-img-container {
            width: 100%;
            height: 200px;
            overflow: hidden;
            border: 2px solid var(--blue);
            box-shadow: 0 0 10px var(--blue);
            margin-bottom: 15px;
            background: #000;
        }
        .boss-img { width: 100%; height: 100%; object-fit: cover; }
        .dg-name-display { font-size: 1.4rem; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
        .dg-timer { font-size: 3rem; color: #fff; font-weight: 700; margin: 10px 0; text-shadow: 0 0 10px var(--red); }
        .confirm-btn-group { display: flex; gap: 15px; justify-content: center; width: 100%; }
        .btn-accept { background: var(--blue); color: #000; font-weight: bold; border: none; padding: 12px 25px; cursor: pointer; width: 45%; }
        .btn-decline { background: transparent; color: #fff; font-weight: bold; border: 1px solid #555; padding: 12px 25px; cursor: pointer; width: 45%; }
        
        /* Cores de Texto Dificuldade */
        .text-white { color: var(--white); text-shadow: 0 0 5px var(--white); }
        .text-orange { color: var(--orange); text-shadow: 0 0 5px var(--orange); }
        .text-red { color: var(--red); text-shadow: 0 0 5px var(--red); }
        .text-purple { color: var(--purple); text-shadow: 0 0 5px var(--purple); }
    </style>
</head>
<body id="b">
    <div id="toxic-overlay"></div>
    <div id="notification">MSG</div>

    <div id="m" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:1000; display:none; justify-content:center; align-items:center;">
        <div style="background:#050a15; border:2px solid var(--blue); padding:30px; width:85%; max-width:400px; text-align:center;">
            <h2 style="margin-bottom:20px; color:var(--blue);">SETTINGS</h2>
            <select id="lang" onchange="game.setLang(this.value)" style="width:100%; padding:12px; background:#000; color:#fff; border:1px solid var(--blue); margin-bottom: 25px; font-family:inherit;">
                <option value="en">English</option>
                <option value="pt">Português</option>
            </select>
            <button onclick="game.reset()" style="width:100%; padding:12px; border:1px solid red; color:red; background:transparent; margin-bottom:10px; font-weight:bold; cursor:pointer;">RESET SYSTEM</button>
            <button onclick="ui.toggleSettings()" style="width:100%; padding:12px; background:var(--blue); color:#000; border:none; font-weight:bold; cursor:pointer;">CLOSE</button>
        </div>
    </div>

    <div class="layout-wrapper">
        <div class="main-frame">
            
            <div id="dungeon-confirm-modal">
                <div class="boss-img-container">
                    <img id="dg-confirm-img" class="boss-img" src="" alt="Boss">
                </div>
                <div style="color:#888; font-size:0.8rem; margin-bottom:5px;">BOSS ENCOUNTER</div>
                <div id="dg-confirm-name" class="dg-name-display">BOSS NAME</div>
                
                <div id="dg-confirm-timer" class="dg-timer">10.00</div>
                
                <div class="confirm-btn-group">
                    <button class="btn-accept" onclick="game.confirmEntry()">ACCEPT</button>
                    <button class="btn-decline" onclick="game.cancelEntry()">DECLINE</button>
                </div>
            </div>

            <div id="penalty-modal">
                <h2 style="color:var(--red); font-size:1.5rem;">PENALTY QUEST</h2>
                <p style="color:#fff; margin:15px 0;">You failed to complete the daily quest.</p>
                <p style="color:#aaa; font-size:0.9rem;">SURVIVE IN THE PENALTY ZONE</p>
                <div style="font-size:3rem; font-weight:bold; color:var(--red); margin:20px 0;">04:00:00</div>
                <button onclick="game.clearPenalty()" style="background:var(--red); border:none; padding:10px 30px; font-weight:bold; cursor:pointer; color:#fff;">SURVIVE</button>
            </div>

            <div id="reward-modal">
                <h3 style="color:var(--blue); margin-bottom:15px;">QUEST COMPLETE</h3>
                <div id="reward-list" class="reward-grid"></div>
                <div style="display:flex; gap:10px; justify-content:center;">
                    <button onclick="game.acceptRewards()" style="background:var(--blue); border:none; padding:10px 20px; font-weight:bold; cursor:pointer;">ACCEPT</button>
                    <button onclick="document.getElementById('reward-modal').style.display='none'" style="background:transparent; border:1px solid #555; color:#555; padding:10px 20px; font-weight:bold; cursor:pointer;">DECLINE</button>
                </div>
            </div>

            <div id="sys-modal">
                <h3 style="color:var(--blue); margin-bottom:10px;">YOU DEFEATED THE ENEMY</h3>
                <div id="sys-msg-detail" style="color:#aaa; font-size:0.9rem; margin-bottom:15px;"></div>
                <div style="font-size:1.2rem; color:var(--blue); margin-bottom:15px; border:1px solid var(--blue); padding:10px; width:100%;">
                    ITEM ACQUIRED<br>
                    <span id="sys-item-name" style="color:#fff; font-weight:bold;">NONE</span>
                </div>
                <button onclick="document.getElementById('sys-modal').style.display='none'" style="background:var(--blue); border:none; padding:8px 20px; font-weight:bold; cursor:pointer;">CONFIRM</button>
            </div>
            
            <div class="top-right-stack">
                <div id="ui-kebab"><button class="kebab-btn" onclick="ui.toggleSettings()"></button></div>
                <div id="ui-pts" class="res-row">
                    <span id="txt-pts-lbl">POINTS:</span> <span id="val-pts" class="sys-num-unified">0</span>
                </div>
            </div>

            <div id="tab-status" class="content active">
                <h2 id="txt-status" class="tab-title">STATUS</h2>
                <div class="header-grid">
                    <div><div id="val-lvl" class="lvl-num">1</div><div style="font-size:0.7rem; color:var(--blue); text-align:center;">LEVEL</div></div>
                    <div class="info-box">
                        <div class="info-row">RANK: <span id="val-rank" class="rank-box">E</span></div>
                        <div class="info-row">JOB: <span id="val-job" class="info-val" style="margin-left:5px;">NONE</span></div>
                        <div class="info-row">TITLE: <span id="val-title" class="info-val" style="margin-left:5px;">NONE</span></div>
                        
                        <div style="margin-top:10px;">
                            <div class="xp-text-display"><span>XP</span><span id="val-xp-txt">0 / 100</span></div>
                            <div class="bar-container" style="margin-top:0;"><div id="xp-bar" class="bar-fill xp-fill"></div></div>
                        </div>

                        <div style="font-size:0.6rem; margin-top:8px;">FATIGUE: <span id="val-fatigue-num">0</span>%</div>
                        <div class="bar-container"><div id="fatigue-bar" class="bar-fill fatigue-fill"></div></div>
                    </div>
                </div>
                
                <div class="equip-slot">
                    <span class="equip-label">EQUIPPED:</span>
                    <span id="val-equipped" class="equip-name">NONE</span>
                </div>

                <div class="stats-list" style="margin-top:15px;">
                    <div class="stat-row"><span class="stat-label">STR</span><span id="val-STR" class="stat-val">10</span><span id="bonus-STR" class="stat-bonus"></span><div class="plus-btn" onclick="game.add('STR')">+</div></div>
                    <div class="stat-row"><span class="stat-label">VIT</span><span id="val-VIT" class="stat-val">10</span><span id="bonus-VIT" class="stat-bonus"></span><div class="plus-btn" onclick="game.add('VIT')">+</div></div>
                    <div class="stat-row"><span class="stat-label">AGI</span><span id="val-AGI" class="stat-val">10</span><span id="bonus-AGI" class="stat-bonus"></span><div class="plus-btn" onclick="game.add('AGI')">+</div></div>
                    <div class="stat-row"><span class="stat-label">INT</span><span id="val-INT" class="stat-val">10</span><span id="bonus-INT" class="stat-bonus"></span><div class="plus-btn" onclick="game.add('INT')">+</div></div>
                    <div class="stat-row"><span class="stat-label">PER</span><span id="val-PER" class="stat-val">10</span><span id="bonus-PER" class="stat-bonus"></span><div class="plus-btn" onclick="game.add('PER')">+</div></div>
                </div>

                <div class="skills-container">
                    <div class="skill-header">SKILLS <small style="font-weight:normal;color:#666;font-size:0.7rem">(Click to Toggle)</small></div>
                    <div id="skills-list"></div>
                </div>
            </div>

            <div id="tab-quests" class="content">
                <h2 id="txt-quests" class="tab-title">DAILY QUESTS</h2>
                <div style="font-size:0.8rem; color:#888; text-align:center; margin-bottom:15px;">COMPLETE DOUBLE FOR HIDDEN REWARD</div>
                <div id="q-list"></div>
                <button id="btn-claim" class="claim-btn" onclick="game.prepareReward()">CLAIM XP</button>
            </div>

            <div id="tab-dungeon" class="content">
                <h2 class="tab-title">DUNGEONS</h2>
                <select id="zone-select" class="zone-selector" onchange="game.setZone(this.value)">
                    <option value="city">CITY GATES</option>
                    <option value="instance">INSTANT DUNGEONS</option>
                    <option value="demon">DEMON CASTLE</option>
                    <option value="jeju">JEJU ISLAND</option>
                </select>
                <div id="dungeon-list"></div>
                <div id="active-mission-box" class="active-mission-box">
                    <div id="mission-timer-text" class="timer-digits">00:00:00</div>
                </div>
            </div>

            <div id="tab-shop" class="content">
                <h2 id="txt-shop" class="tab-title">SHOP</h2>
                <div class="shop-grid">
                    <div class="shop-item" onclick="game.buy('Bandage', 30)">BANDAGE<br><span class="gold-wrapper"><span class="sys-num-unified">30</span><span class="gold-icon">G</span></span><small>-10 Fatigue</small></div>
                    <div class="shop-item" onclick="game.buy('Soju Bottle', 50)">SOJU<br><span class="gold-wrapper"><span class="sys-num-unified">50</span><span class="gold-icon">G</span></span><small style="color:var(--red)">TOXIC</small></div>
                    <div class="shop-item" onclick="game.buy('Random Box', 500)">RANDOM BOX<br><span class="gold-wrapper"><span class="sys-num-unified">500</span><span class="gold-icon">G</span></span><small>Mystery</small></div>
                    <div class="shop-item" onclick="game.buy('Knight Killer', 1500)">KNIGHT KILLER<br><span class="gold-wrapper"><span class="sys-num-unified">1500</span><span class="gold-icon">G</span></span><small>+20 STR</small></div>
                </div>
                <h3 style="margin-top:25px; border-bottom:1px solid #333;" id="txt-inv">INVENTORY</h3>
                <div id="inv-list" style="padding-top:10px;"></div>
            </div>

        </div>

        <div id="gold-container-wrapper">
            <div class="gold-box-frame">
                <span id="txt-gold-lbl" style="font-size:0.8rem; color:#8899aa;">GOLD:</span> 
                <span class="gold-wrapper">
                    <span id="val-gold" class="sys-num-unified">0</span><span class="gold-icon">G</span>
                </span>
            </div>
        </div>
    </div>

    <nav class="nav-bar">
        <button class="nav-btn active" id="n-status" onclick="ui.tab('status')">STATUS</button>
        <button class="nav-btn" id="n-quests" onclick="ui.tab('quests')">QUESTS</button>
        <button class="nav-btn" id="n-dungeon" onclick="ui.tab('dungeon')">DUNGEON</button>
        <button class="nav-btn" id="n-shop" onclick="ui.tab('shop')">SHOP</button>
    </nav>

    <script>
        const trans = {
            en: { status: "STATUS", quests: "DAILY QUESTS", shop: "SHOP", pts: "POINTS:", gold: "GOLD:", settings: "SETTINGS", inv: "INVENTORY", empty: "Empty", use: "USE", sell: "SELL", equip: "EQUIP", unequip: "UNEQUIP", claim: "[ CLAIM REWARDS ]", q1: "Push-ups", q2: "Sit-ups", q3: "Squats", q4: "Running (km)", j0: "NONE", j1: "NECROMANCER", j2: "SHADOW MONARCH", t0: "NONE", t1: "WOLF SLAYER", t2: "THE ONE WHO OVERCAME ADVERSITY", t3: "DEMON SLAYER" },
            pt: { status: "STATUS", quests: "MISSÕES", shop: "LOJA", pts: "PONTOS:", gold: "OURO:", settings: "CONFIGURAÇÕES", inv: "INVENTÁRIO", empty: "Vazio", use: "USAR", sell: "VENDER", equip: "EQUIPAR", unequip: "DESEQUIPAR", claim: "[ RESGATAR ]", q1: "Flexões", q2: "Abdominais", q3: "Agachamentos", q4: "Corrida (km)", j0: "NENHUM", j1: "NECROMANTE", j2: "MONARCA DAS SOMBRAS", t0: "NENHUM", t1: "MATADOR DE LOBOS", t2: "AQUELE QUE SUPEROU A ADVERSIDADE", t3: "MATADOR DE DEMÔNIOS" }
        };

        const MIN = 60000;
        const HOUR = 3600000;
        
        const itemsDB = {
            "Bandage": { type: 'consume', price: 30, desc: "-10 Fatigue" },
            "Potion": { type: 'consume', price: 100, desc: "-40 Fatigue" },
            "Soju Bottle": { type: 'toxic', price: 50, desc: "Alcohol (+20 Fatigue)" },
            "Random Box": { type: 'consume', price: 500, desc: "Mystery Item" },
            "Blessed Box": { type: 'consume', price: 2500, desc: "Rare Rewards" },
            "Cursed Box": { type: 'consume', price: 500, desc: "Risky Rewards" },
            "Instance Key": { type: 'misc', price: 100, desc: "Unlocks Subway" },
            "Demon Castle Key": { type: 'misc', price: 500, desc: "Unlocks S-Rank" },
            "E-Rank Dagger": { type: 'equip', price: 500, stats: {STR: 5, AGI: 2}, desc: "Basic Dagger" },
            "Kasaka's Venom Fang": { type: 'equip', price: 3000, stats: {STR: 15, AGI: 15}, desc: "Paralysis Effect" },
            "Knight Killer": { type: 'equip', price: 1500, stats: {STR: 25, VIT: 5}, desc: "Armor Pierce" },
            "Demon King's Dagger": { type: 'equip', price: 20000, stats: {STR: 60, AGI: 40}, desc: "S-Rank Weapon" },
            "Orb of Avarice": { type: 'equip', price: 8000, stats: {INT: 50}, desc: "Magic Boost" },
            "Goblin Stone": { type: 'misc', price: 10 }, 
            "Lycan Fang": { type: 'misc', price: 25 }, 
            "Centipede Shell": { type: 'misc', price: 50 }, 
            "Ice Crystal": { type: 'misc', price: 100 }, 
            "Orc Tusk": { type: 'misc', price: 250 }, 
            "Ant Wing": { type: 'misc', price: 1000 }, 
            "Baruka's Dagger": { type: 'equip', price: 5000, stats: {AGI:35, STR:10} },
            "Demon Soul": { type: 'misc', price: 2000 }
        };

        // NOTA: Para usar suas próprias imagens, coloque-as em uma pasta 'img'
        // Exemplo: 'img/goblin.jpg', 'img/kasaka.jpg'
        // Estou usando links de placeholder para demonstração.
        const dungeonData = [
            // CITY GATES
            { 
                zone: "city", name: "E-Rank Gate", mob: "Goblin", diff: "white", 
                img: "img/goblin.webp", // Certifique-se que existe goblin.jpg na pasta img
                drop: "Goblin Stone", xp: 5, cost: 5, visualTime: 3, cooldownTime: 1 * MIN, minLvl: 1 
            }, 
            { 
                zone: "city", name: "D-Rank Gate", mob: "Steel Fang Lycan", diff: "white", 
                img: "img/lycan.webp", // Nome da imagem do lobo
                drop: "Lycan Fang", xp: 15, cost: 10, visualTime: 5, cooldownTime: 5 * MIN, minLvl: 5 
            }, 
            { 
                zone: "city", name: "C-Rank Gate", mob: "Giant Centipede", diff: "orange", 
                img: "img/centipede.webp", // Nome da imagem da centopeia
                drop: "Centipede Shell", xp: 40, cost: 20, visualTime: 8, cooldownTime: 15 * MIN, minLvl: 15 
            }, 
            { 
                zone: "city", name: "B-Rank Gate", mob: "Ice Bear", diff: "orange", 
                img: "img/icebear.webp", // Nome da imagem do urso
                drop: "Ice Crystal", xp: 80, cost: 30, visualTime: 10, cooldownTime: 30 * MIN, minLvl: 25 
            }, 
            { 
                zone: "city", name: "A-Rank Gate", mob: "High Orc", diff: "red", 
                img: "img/highorc.webp", // Nome da imagem do orc
                drop: "Orc Tusk", xp: 150, cost: 50, visualTime: 15, cooldownTime: 1 * HOUR, minLvl: 35 
            }, 
            
            // INSTANT DUNGEONS (Iconic)
            { 
                zone: "instance", name: "Hapjeong Subway", mob: "Blue Venom-Fang Kasaka", diff: "purple", 
                img: "img/kasaka.webp", // Imagem da cobra azul
                drop: "Kasaka's Venom Fang", xp: 600, cost: 40, visualTime: 15, cooldownTime: 0, minLvl: 1, isInstance: true 
            },
            { 
                zone: "instance", name: "Double Dungeon", mob: "Statue of God", diff: "purple", 
                img: "img/statue.webp", // Imagem da Estatua de Deus (Sorriso)
                drop: "Cursed Box", xp: 0, cost: 90, visualTime: 20, cooldownTime: 24 * HOUR, minLvl: 10 
            },
            { 
                zone: "instance", name: "Job Change Quest", mob: "Blood-Red Igris", diff: "red", 
                img: "img/igris.webp", // Imagem do Igris
                drop: "Knight Killer", xp: 2000, cost: 60, visualTime: 25, cooldownTime: 6 * HOUR, minLvl: 40 
            },

            // DEMON CASTLE
            { 
                zone: "demon", name: "Lower Floors", mob: "Mean Soul", diff: "orange", 
                img: "img/demonsoul.webp", // Imagem de demônio genérico
                drop: "Demon Soul", xp: 300, cost: 30, visualTime: 10, cooldownTime: 1 * HOUR, minLvl: 50 
            },
            { 
                zone: "demon", name: "Upper Floors", mob: "Vulcan of the Covetous", diff: "red", 
                img: "img/vulcan.webp", // Imagem do Vulcan (Gordo verde)
                drop: "Orb of Avarice", xp: 1000, cost: 50, visualTime: 20, cooldownTime: 4 * HOUR, minLvl: 60 
            },
            { 
                zone: "demon", name: "Top Floor", mob: "Demon King Baran", diff: "purple", 
                img: "img/baran.webp", // Imagem do Baran (Dragão Wyvern)
                drop: "Demon King's Dagger", xp: 5000, cost: 80, visualTime: 30, cooldownTime: 12 * HOUR, minLvl: 75 
            },

            // JEJU ISLAND
            { 
                zone: "jeju", name: "Outer Island", mob: "Giant Ant", diff: "red", 
                img: "img/giantant.webp", // Formiga normal
                drop: "Ant Wing", xp: 500, cost: 40, visualTime: 15, cooldownTime: 2 * HOUR, minLvl: 60 
            },
            { 
                zone: "jeju", name: "Ant Tunnel", mob: "Ant King Beru", diff: "purple", 
                img: "img/beru.webp", // Imagem do Beru
                drop: "Black Heart (Core)", xp: 10000, cost: 100, visualTime: 40, cooldownTime: 48 * HOUR, minLvl: 80 
            }
        ];

        const skillsData = {
            "Sprint": { lvl: 1, type: "active", desc: "Speed +30% (Costs Fatigue)", active: false },
            "Stealth": { lvl: 10, type: "active", desc: "Crit Rate + (Costs Fatigue)", active: false },
            "Vital Strike": { lvl: 15, type: "passive", desc: "Gold Drops +", active: true },
            "Courage of the Weak": { lvl: 1, type: "passive", desc: "Detox Buff", active: true } 
        };

        let missionTimer = null; 
        let pendingRewards = null;
        let confirmTimer = null;
        let pendingDungeonIdx = null; // Store index for confirmation

        function msToTime(duration) {
            let seconds = Math.floor((duration / 1000) % 60);
            let minutes = Math.floor((duration / (1000 * 60)) % 60);
            let hours = Math.floor((duration / (1000 * 60 * 60)) % 24);
            return (hours < 10 ? "0" + hours : hours) + ":" + (minutes < 10 ? "0" + minutes : minutes) + ":" + (seconds < 10 ? "0" + seconds : seconds);
        }

        const game = {
            data: { 
                stats: { STR: 10, VIT: 10, AGI: 10, INT: 10, PER: 10 }, 
                pts: 3, lvl: 1, gold: 0, xp: 0, fatigue: 0, lang: 'en', 
                inventory: [], 
                equipped: null,
                quests: [
                    {id:'q1', current:0, target:100, step:10}, 
                    {id:'q2', current:0, target:100, step:10}, 
                    {id:'q3', current:0, target:100, step:10}, 
                    {id:'q4', current:0, target:10, step:1} 
                ],
                unlockedSkills: ["Sprint", "Courage of the Weak"], 
                activeSkills: [], 
                dungeonCooldowns: [],
                lastLoginDay: new Date().toDateString(),
                dailyCompleted: false,
                instanceUnlocked: false,
                lastFatigueTick: Date.now(),
                currentZone: 'city'
            },
            init() {
                const s = localStorage.getItem('solo_v50');
                if(s) {
                    const parsed = JSON.parse(s);
                    this.data = {...this.data, ...parsed};
                    if(!this.data.activeSkills) this.data.activeSkills = [];
                    if(!this.data.currentZone) this.data.currentZone = 'city';
                }
                this.checkDailyPenalty();
                ui.tab('status'); 
                ui.render();
                setInterval(() => this.tick(), 1000);
            },
            save() { localStorage.setItem('solo_v50', JSON.stringify(this.data)); },
            setLang(l) { this.data.lang = l; this.save(); ui.render(); },
            reset() { if(confirm("RESET SYSTEM?")) { localStorage.removeItem('solo_v50'); location.reload(); } },
            add(k) { if(this.data.pts > 0) { this.data.stats[k]++; this.data.pts--; this.save(); ui.render(); } },
            getMaxXP(lvl) { return lvl * 100; },
            
            getRank(l) { 
                if(l<=10) return 'E'; if(l<=20) return 'D'; if(l<=40) return 'C'; if(l<=60) return 'B'; if(l<=80) return 'A'; return 'S'; 
            },
            getJobKey(l) { if(l < 40) return 'j0'; if(l < 100) return 'j1'; return 'j2'; },
            getTitleKey(l) { if(l < 10) return 't0'; if(l < 30) return 't1'; if(l < 60) return 't2'; return 't3'; },

            getTotalStats() {
                let t = { ...this.data.stats };
                if (this.data.equipped) {
                    const item = itemsDB[this.data.equipped];
                    if (item && item.stats) { for(let s in item.stats) if(t[s] !== undefined) t[s] += item.stats[s]; }
                }
                return t;
            },

            toggleSkill(skillName) {
                const skillInfo = skillsData[skillName];
                if(skillInfo.type === 'passive') return; 
                const idx = this.data.activeSkills.indexOf(skillName);
                if(idx > -1) this.data.activeSkills.splice(idx, 1); 
                else this.data.activeSkills.push(skillName); 
                this.save(); ui.render();
            },

            checkDailyPenalty() {
                const today = new Date().toDateString();
                if(this.data.lastLoginDay !== today) {
                    if(!this.data.dailyCompleted) {
                        document.getElementById('penalty-modal').style.display = 'flex';
                        this.data.fatigue = 100; 
                    }
                    this.data.quests.forEach(q => q.current = 0);
                    this.data.dailyCompleted = false;
                    this.data.lastLoginDay = today;
                    this.save();
                }
            },
            clearPenalty() {
                document.getElementById('penalty-modal').style.display = 'none';
                ui.notify("SURVIVED PENALTY ZONE", "negative");
            },

            setZone(z) { this.data.currentZone = z; this.save(); ui.render(); },

            tick() {
                const now = Date.now();
                if (this.data.fatigue > 0 && (now - (this.data.lastFatigueTick || now)) >= (5 * MIN)) {
                    this.data.fatigue = Math.max(0, this.data.fatigue - 1);
                    this.data.lastFatigueTick = now;
                    if(document.getElementById('tab-status').classList.contains('active')) ui.render();
                    this.save();
                }
                if (!this.data.lastFatigueTick) this.data.lastFatigueTick = now;

                if(document.getElementById('tab-dungeon').classList.contains('active')) {
                    ui.updateDungeonButtons();
                }
            },

            addQuestProgress(i) {
                if(this.data.dailyCompleted) return;
                const q = this.data.quests[i];
                if (q.current < q.target * 2) {
                    q.current += q.step;
                    this.save();
                    ui.render();
                } else {
                    ui.notify("MAXIMUM LIMIT REACHED");
                }
            },

            prepareReward() {
                if(this.data.dailyCompleted) return;
                const allComplete = this.data.quests.every(q => q.current >= q.target);
                if(!allComplete) { ui.notify("COMPLETE ALL QUESTS"); return; }
                const isHidden = this.data.quests.every(q => q.current >= q.target * 2);
                pendingRewards = [];
                pendingRewards.push("Full Recovery");
                pendingRewards.push("+3 Stat Points");
                if(isHidden) {
                    pendingRewards.push("Blessed Box");
                    pendingRewards.push("Hidden Reward: Cursed Box");
                } else {
                    pendingRewards.push("Random Box");
                }
                ui.showRewardModal(pendingRewards, isHidden);
            },

            acceptRewards() {
                if(!pendingRewards) return;
                this.data.fatigue = 0;
                this.data.pts += 3;
                this.data.xp += 100;
                ui.notify("REWARDS ACCEPTED"); 
                pendingRewards.forEach(r => {
                    if(r === "Random Box") this.data.inventory.push("Random Box");
                    if(r === "Blessed Box") this.data.inventory.push("Blessed Box");
                    if(r.includes("Cursed")) this.data.inventory.push("Cursed Box");
                });
                this.data.dailyCompleted = true;
                this.checkLevelUp();
                this.save();
                document.getElementById('reward-modal').style.display = 'none';
                ui.render();
            },
            
            checkLevelUp() {
                let maxXP = this.getMaxXP(this.data.lvl);
                while(this.data.xp >= maxXP) { 
                    this.data.xp -= maxXP; 
                    this.data.lvl++; 
                    this.data.pts += 3; 
                    this.checkSkillUnlock();
                    ui.notify("LEVEL UP!"); 
                    maxXP = this.getMaxXP(this.data.lvl);
                }
            },

            checkSkillUnlock() {
                for(let s in skillsData) {
                    if(this.data.lvl >= skillsData[s].lvl && !this.data.unlockedSkills.includes(s)) {
                        this.data.unlockedSkills.push(s);
                        ui.notify(`SKILL UNLOCKED: ${s}`);
                    }
                }
            },

            // --- NOVO SISTEMA DE ENTRADA (VISUAL) ---
            enterDungeon(idx) {
                // Filtra para achar a dungeon correta da lista atual
                const filtered = dungeonData.filter(d => d.zone === this.data.currentZone);
                const dg = filtered[idx];
                
                // Pega o index global
                const globalIdx = dungeonData.findIndex(d => d.name === dg.name);
                const now = Date.now();

                // Verifica Cooldown antes de abrir o modal
                if(!dg.isInstance) {
                    const unlockTime = this.data.dungeonCooldowns[globalIdx] || 0;
                    if (now < unlockTime) { ui.notify("DUNGEON LOCKED", "negative"); return; }
                }

                pendingDungeonIdx = idx; // Guarda qual dungeon foi clicada
                ui.showDungeonConfirm(dg);
            },

            // Chamado quando clica em ACCEPT
            confirmEntry() {
                ui.stopConfirmTimer();
                const idx = pendingDungeonIdx;
                const filtered = dungeonData.filter(d => d.zone === this.data.currentZone);
                const dg = filtered[idx];
                const globalIdx = dungeonData.findIndex(d => d.name === dg.name);

                // Lógica de Missão Original
                const totalStats = this.getTotalStats();
                const vitBonus = Math.floor(totalStats.VIT * 0.2);
                let finalCost = dg.cost - vitBonus;

                const useStealth = this.data.activeSkills.includes("Stealth");
                if(useStealth) finalCost += 20;
                if (finalCost < 1) finalCost = 1;

                if(this.data.fatigue + finalCost > 100) { ui.notify("FATIGUE TOO HIGH!", "negative"); return; }
                
                this.data.fatigue += finalCost;
                this.save();
                ui.render();
                
                const agiMod = Math.min(0.6, totalStats.AGI * 0.02);
                const useSprint = this.data.activeSkills.includes("Sprint");
                const sprintMod = useSprint ? 0.3 : 0; 
                const finalTime = Math.max(1, dg.visualTime * (1 - agiMod - sprintMod));

                ui.startMissionTimer(finalTime, () => {
                    if(!dg.isInstance) this.data.dungeonCooldowns[globalIdx] = Date.now() + dg.cooldownTime;

                    let winChance = 0.75 + (totalStats.STR * 0.01);
                    if(useStealth) winChance += 0.20; 
                    if (winChance > 0.99) winChance = 0.99;

                    ui.stopMissionTimer(); 
                    
                    if(Math.random() < winChance) {
                        const intBonus = 1 + (totalStats.INT * 0.05);
                        const finalXP = Math.floor(dg.xp * intBonus);
                        this.data.xp += finalXP; 
                        
                        const useVital = this.data.unlockedSkills.includes("Vital Strike");
                        if(useVital) {
                            const extraGold = 50;
                            this.data.gold += extraGold;
                            ui.notify("CRITICAL: EXTRA GOLD", "positive");
                        }

                        const dropItem = itemsDB[dg.drop];
                        if (dropItem && dropItem.type === 'equip' && (this.data.inventory.includes(dg.drop) || this.data.equipped === dg.drop)) {
                            this.data.gold += (dropItem.price || 1000);
                            ui.notify(`DUPLICATE CONVERTED TO GOLD`);
                        } else {
                            this.data.inventory.push(dg.drop);
                        }
                        if(dg.isInstance) { this.data.instanceUnlocked = false; ui.notify("INSTANCE CLOSED"); }

                        this.checkLevelUp();
                        ui.showSysModal(dg.mob, dg.drop);
                    } else { ui.notify("DEFEAT! ESCAPED SAFELY...", "negative"); }
                    this.save(); ui.render();
                });
            },

            cancelEntry() {
                ui.stopConfirmTimer();
                ui.notify("DUNGEON ENTRY CANCELED");
            },

            buy(n, c) { if(this.data.gold >= c) { this.data.gold -= c; this.data.inventory.push(n); this.save(); ui.render(); ui.notify("BOUGHT: " + n); } else { ui.notify("NOT ENOUGH GOLD", "negative"); } },
            
            useItem(index) {
                const item = this.data.inventory[index];
                const dbItem = itemsDB[item];

                if (dbItem && dbItem.type === 'equip') {
                    if (this.data.equipped) this.data.inventory.push(this.data.equipped);
                    this.data.equipped = item;
                    this.data.inventory.splice(index, 1);
                    this.save(); ui.render(); ui.notify("EQUIPPED: " + item);
                    return;
                }

                if(dbItem && dbItem.type === 'toxic') {
                    this.data.inventory.splice(index, 1);
                    const hasCourage = this.data.unlockedSkills.includes("Courage of the Weak");
                    if(hasCourage) {
                        ui.triggerDetox();
                        this.data.fatigue = Math.max(0, this.data.fatigue - 20);
                        ui.notify("DETOX: CORAGEM DOS FRACOS", "positive");
                    } else {
                        ui.triggerToxic();
                        this.data.fatigue = Math.min(100, this.data.fatigue + 20);
                        ui.notify("ENVENENADO!", "negative");
                    }
                    this.save(); ui.render();
                    return;
                }

                if(item.includes('Box')) {
                    this.data.inventory.splice(index, 1);
                    if(item === 'Cursed Box') {
                         this.data.fatigue = 99; 
                         ui.notify("CURSE: FATIGUE INCREASED", "negative");
                    } else {
                        const rnd = Math.random();
                        if(rnd < 0.1) { this.data.inventory.push("Instance Key"); ui.notify("FOUND: KEY"); }
                        else if(rnd < 0.4) { this.data.inventory.push("Potion"); ui.notify("FOUND: POTION"); }
                        else { this.data.gold += 1000; ui.notify("FOUND: GOLD"); }
                    }
                    this.save(); ui.render();
                    return;
                }

                if(item === 'Instance Key') {
                    if(this.data.instanceUnlocked) ui.notify("ALREADY UNLOCKED");
                    else { this.data.instanceUnlocked = true; this.data.inventory.splice(index, 1); ui.notify("UNLOCKED: SUBWAY"); }
                    this.save(); ui.render(); return;
                }
                
                if(item === 'Bandage') { this.data.fatigue -= 10; ui.notify("RECOVERED", "positive"); }
                else if(item === 'Potion') { this.data.fatigue -= 40; ui.notify("RECOVERED", "positive"); }
                else { ui.notify("CANNOT USE.", "negative"); return; }
                
                if(this.data.fatigue < 0) this.data.fatigue = 0;
                this.data.inventory.splice(index, 1); this.save(); ui.render();
            },

            unequip() {
                if(this.data.equipped) {
                    this.data.inventory.push(this.data.equipped);
                    this.data.equipped = null;
                    this.save(); ui.render();
                }
            },

            sellItem(index) {
                const item = this.data.inventory[index];
                const dbItem = itemsDB[item];
                const price = Math.floor((dbItem ? dbItem.price : 10) / 2); 
                this.data.gold += price;
                this.data.inventory.splice(index, 1);
                this.save(); ui.render(); ui.notify(`SOLD: +${price}G`);
            }
        };

        const ui = {
            tab(n) {
                const els = { kebab: document.getElementById('ui-kebab'), pts: document.getElementById('ui-pts'), goldBox: document.getElementById('gold-container-wrapper') };
                const showResources = (n === 'status' || n === 'shop');
                els.goldBox.style.display = showResources ? 'flex' : 'none';
                els.kebab.style.display = (n === 'status') ? 'flex' : 'none';
                els.pts.style.display = (n === 'status') ? 'flex' : 'none';

                document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                document.getElementById('tab-' + n).classList.add('active');
                document.getElementById('n-' + n).classList.add('active');
            },

            // --- VISUAL DO BOSS ---
            showDungeonConfirm(dg) {
                const modal = document.getElementById('dungeon-confirm-modal');
                const img = document.getElementById('dg-confirm-img');
                const name = document.getElementById('dg-confirm-name');
                const timer = document.getElementById('dg-confirm-timer');
                
                img.src = dg.img;
                name.innerText = dg.mob;
                
                // Colorize name based on difficulty
                name.className = 'dg-name-display'; // reset
                if(dg.diff === 'white') name.classList.add('text-white');
                else if(dg.diff === 'orange') name.classList.add('text-orange');
                else if(dg.diff === 'red') name.classList.add('text-red');
                else if(dg.diff === 'purple') name.classList.add('text-purple');

                modal.style.display = 'flex';

                let timeLeft = 10.0;
                timer.innerText = "10.00";
                
                if (confirmTimer) clearInterval(confirmTimer);
                confirmTimer = setInterval(() => {
                    timeLeft -= 0.1;
                    if(timeLeft <= 0) {
                        game.cancelEntry(); // Time out treated as decline
                    } else {
                        timer.innerText = timeLeft.toFixed(2);
                    }
                }, 100);
            },

            stopConfirmTimer() {
                if (confirmTimer) clearInterval(confirmTimer);
                document.getElementById('dungeon-confirm-modal').style.display = 'none';
            },

            showRewardModal(rewards, isHidden) {
                const list = document.getElementById('reward-list');
                list.innerHTML = '';
                rewards.forEach(r => {
                    list.innerHTML += `<div class="reward-box-item">${r}</div>`;
                });
                document.getElementById('reward-modal').style.display = 'flex';
            },

            triggerToxic() {
                const ov = document.getElementById('toxic-overlay');
                ov.className = 'toxic-red'; ov.style.opacity = '1';
                setTimeout(() => ov.style.opacity = '0', 2000);
            },
            triggerDetox() {
                const ov = document.getElementById('toxic-overlay');
                ov.className = 'detox-green'; ov.style.opacity = '1';
                setTimeout(() => ov.style.opacity = '0', 2000);
            },

            startMissionTimer(durationSeconds, onComplete) {
                const timerContainer = document.getElementById('active-mission-box');
                const timerText = document.getElementById('mission-timer-text');
                timerContainer.classList.add('visible');
                let remaining = durationSeconds;
                const updateText = () => {
                   let m = Math.floor(remaining / 60); let s = Math.floor(remaining % 60); let ms = Math.floor((remaining % 1) * 100);
                   timerText.innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}:${ms < 10 ? '0'+ms : ms}`;
                };
                updateText();
                if (missionTimer) clearInterval(missionTimer);
                missionTimer = setInterval(() => {
                    remaining -= 0.1; 
                    if (remaining <= 0) {
                        clearInterval(missionTimer);
                        timerText.innerText = `00:00:00`;
                        setTimeout(() => { onComplete(); }, 500);
                        return;
                    }
                    updateText();
                }, 100); 
            },

            stopMissionTimer() {
                if (missionTimer) clearInterval(missionTimer);
                const timerContainer = document.getElementById('active-mission-box');
                timerContainer.classList.remove('visible');
            },

            updateDungeonButtons() {
                const now = Date.now();
                const visibleBtns = document.querySelectorAll('.enter-btn');
                const filtered = dungeonData.filter(d => d.zone === game.data.currentZone);
                
                visibleBtns.forEach((btn, i) => {
                    if (i >= filtered.length) return; 
                    const dg = filtered[i];
                    if(btn.classList.contains('instance')) { btn.innerText = "ENTER"; return; }
                    
                    const globalIdx = dungeonData.findIndex(d => d.name === dg.name);
                    const unlockTime = game.data.dungeonCooldowns[globalIdx] || 0;
                    
                    if (now < unlockTime) {
                        btn.innerText = msToTime(unlockTime - now);
                        btn.classList.add('cooldown'); btn.disabled = true;
                    } else {
                        btn.innerText = "ENTER";
                        btn.classList.remove('cooldown'); btn.disabled = false;
                    }
                });
            },

            updateClaimButton() {
                const btn = document.getElementById('btn-claim');
                if (game.data.dailyCompleted) {
                    btn.innerText = "COMPLETED";
                    btn.classList.add('disabled');
                } else {
                    btn.innerText = "[ CLAIM REWARDS ]";
                    btn.classList.remove('disabled');
                }
            },

            toggleSettings() { document.getElementById('m').style.display = (document.getElementById('m').style.display === 'flex') ? 'none' : 'flex'; },
            
            notify(m, type = 'normal') { 
                const n = document.getElementById('notification'); 
                n.innerText = m; 
                n.className = '';
                if (type === 'positive') n.classList.add('positive');
                else if (type === 'negative') n.classList.add('negative');
                n.style.display = 'block'; 
                setTimeout(() => n.style.display = 'none', 2000); 
            },
            
            showSysModal(mob, item) {
                document.getElementById('sys-msg-detail').innerText = `You have slain the ${mob}.`;
                document.getElementById('sys-item-name').innerText = item;
                document.getElementById('sys-modal').style.display = 'flex';
            },
            
            render() {
                const d = game.data; const t = trans[d.lang];
                document.getElementById('zone-select').value = d.currentZone;
                document.getElementById('txt-status').innerText = t.status;
                document.getElementById('txt-quests').innerText = t.quests;
                document.getElementById('txt-shop').innerText = t.shop;
                document.getElementById('txt-inv').innerText = t.inv;
                document.getElementById('n-status').innerText = t.status;
                document.getElementById('n-quests').innerText = t.quests;
                document.getElementById('n-dungeon').innerText = "DUNGEON";
                document.getElementById('n-shop').innerText = t.shop;
                document.getElementById('val-lvl').innerText = d.lvl;
                document.getElementById('val-pts').innerText = d.pts;
                document.getElementById('val-gold').innerText = d.gold;
                document.getElementById('val-fatigue-num').innerText = d.fatigue;
                
                const maxXP = game.getMaxXP(d.lvl);
                const xpPercent = Math.min(100, (d.xp / maxXP) * 100);
                document.getElementById('xp-bar').style.width = xpPercent + "%";
                document.getElementById('val-xp-txt').innerText = `${Math.floor(d.xp)} / ${maxXP}`;
                document.getElementById('fatigue-bar').style.width = d.fatigue + "%";
                
                document.getElementById('val-rank').innerText = game.getRank(d.lvl);
                document.getElementById('val-job').innerText = t[game.getJobKey(d.lvl)];
                document.getElementById('val-title').innerText = t[game.getTitleKey(d.lvl)];
                
                const totalStats = game.getTotalStats();
                for(let k in d.stats) {
                    document.getElementById('val-'+k).innerText = d.stats[k];
                    const bonus = totalStats[k] - d.stats[k];
                    document.getElementById('bonus-'+k).innerText = bonus > 0 ? `(+${bonus})` : '';
                }

                if(d.equipped) {
                    document.getElementById('val-equipped').innerText = d.equipped;
                    document.getElementById('val-equipped').innerHTML += ` <button class="btn-small unequip" onclick="game.unequip()">X</button>`;
                } else { document.getElementById('val-equipped').innerText = "NONE"; }
                
                const sl = document.getElementById('skills-list'); sl.innerHTML = '';
                for(let sKey in skillsData) {
                    const sk = skillsData[sKey];
                    const unlocked = d.unlockedSkills.includes(sKey);
                    if(unlocked) {
                        const isActive = d.activeSkills.includes(sKey);
                        const isPassive = sk.type === 'passive';
                        const activeClass = (isActive || isPassive) ? 'active' : '';
                        const passiveClass = isPassive ? 'passive' : '';
                        const statusText = isPassive ? 'PASSIVE' : (isActive ? 'ON' : 'OFF');
                        const onclick = isPassive ? '' : `onclick="game.toggleSkill('${sKey}')"`;
                        
                        sl.innerHTML += `
                        <div class="skill-card">
                            <div><div class="skill-name">${sKey}</div><div class="skill-desc">${sk.desc}</div></div>
                            <button class="skill-btn ${activeClass} ${passiveClass}" ${onclick}>${statusText}</button>
                        </div>`;
                    }
                }

                const qL = document.getElementById('q-list'); qL.innerHTML = '';
                d.quests.forEach((q, i) => {
                    const isComplete = q.current >= q.target;
                    const isOver = q.current >= q.target * 2;
                    const statusClass = isOver ? 'q-over' : (isComplete ? 'q-complete' : '');
                    const statusText = isOver ? 'HIDDEN COMPLETE' : (isComplete ? 'COMPLETE' : 'INCOMPLETE');
                    const disabled = isOver ? 'disabled' : '';

                    qL.innerHTML += `
                    <div class="quest-item">
                        <div class="q-top">
                            <span>${t[q.id]}</span>
                            <span class="${statusClass}">[ ${statusText} ]</span>
                        </div>
                        <div class="q-controls">
                            <span class="q-val">${q.current} / ${q.target}</span>
                            <button class="q-btn" onclick="game.addQuestProgress(${i})" ${disabled}>+</button>
                        </div>
                    </div>`;
                });
                this.updateClaimButton();

                const dL = document.getElementById('dungeon-list'); dL.innerHTML = '';
                const filteredDungeons = dungeonData.filter(d => d.zone === game.data.currentZone);
                
                if (filteredDungeons.length === 0) {
                     dL.innerHTML = `<div style="text-align:center; color:#666; padding:20px;">LOCKED ZONE</div>`;
                } else {
                    filteredDungeons.forEach((dg, i) => {
                        const styleClass = dg.isInstance ? 'enter-btn instance' : 'enter-btn';
                        dL.innerHTML += `<div class="dungeon-item"><div><div style="font-weight:bold;">${dg.name}</div><div class="mon-${dg.diff}" style="font-size:0.8rem;">${dg.mob}</div></div><button class="${styleClass}" onclick="game.enterDungeon(${i})">ENTER</button></div>`;
                    });
                }
                this.updateDungeonButtons();

                const iL = document.getElementById('inv-list');
                if(d.inventory.length === 0) iL.innerHTML = `<div style="color:#444;text-align:center;">${t.empty}</div>`;
                else iL.innerHTML = d.inventory.map((item, index) => {
                    const dbItem = itemsDB[item];
                    let desc = dbItem ? dbItem.desc : '';
                    const actionBtn = (dbItem && dbItem.type === 'equip') ? `<button onclick="game.useItem(${index})" class="btn-small equip">${t.equip}</button>` : `<button onclick="game.useItem(${index})" class="btn-small">${t.use}</button>`;
                    return `<div class="item-card"><div><span>${item}</span><div style="font-size:0.6rem;color:#666">${desc}</div></div><div style="display:flex;gap:5px;">${actionBtn}<button onclick="game.sellItem(${index})" class="btn-small">${t.sell}</button></div></div>`;
                }).join('');
            }
        };
        game.init();
    </script>
</body>
</html>